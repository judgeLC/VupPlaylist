<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简单风格测试</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .song { margin: 10px 0; padding: 10px; border: 1px solid #ddd; }
        .genre { font-weight: bold; color: #007bff; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>风格显示测试</h1>
    <div id="results"></div>

    <script src="data.js"></script>
    <script>
        // 简单的风格显示名称获取函数
        function getGenreDisplayName(genreId) {
            // 首先检查是否有官方数据
            if (window.officialData && window.officialData.customGenres) {
                const matchedGenre = window.officialData.customGenres.find(g => g.id === genreId);
                if (matchedGenre) {
                    return matchedGenre.name;
                }
            }
            
            // 如果没有找到，返回原ID
            return genreId;
        }

        // 测试函数
        function testGenreDisplay() {
            const resultsDiv = document.getElementById('results');
            let html = '';

            // 检查数据是否加载
            if (!window.officialData) {
                html += '<p class="error">错误：window.officialData 未加载</p>';
                resultsDiv.innerHTML = html;
                return;
            }

            if (!window.officialData.songs) {
                html += '<p class="error">错误：songs 数据未找到</p>';
                resultsDiv.innerHTML = html;
                return;
            }

            if (!window.officialData.customGenres) {
                html += '<p class="error">错误：customGenres 数据未找到</p>';
                resultsDiv.innerHTML = html;
                return;
            }

            html += `<p class="success">✓ 数据加载成功</p>`;
            html += `<p>歌曲总数: ${window.officialData.songs.length}</p>`;
            html += `<p>自定义风格数: ${window.officialData.customGenres.length}</p>`;

            // 显示前10首歌的风格
            html += '<h2>前10首歌的风格显示测试:</h2>';
            
            const testSongs = window.officialData.songs.slice(0, 10);
            testSongs.forEach((song, index) => {
                const genreDisplay = getGenreDisplayName(song.genre);
                const isCorrect = genreDisplay !== song.genre;
                
                html += `<div class="song">
                    <strong>歌曲 ${index + 1}:</strong> ${song.title}<br>
                    <strong>原始风格ID:</strong> ${song.genre}<br>
                    <strong>显示风格:</strong> <span class="genre ${isCorrect ? 'success' : 'error'}">${genreDisplay}</span>
                    ${isCorrect ? ' ✓' : ' ✗ (显示原ID)'}
                </div>`;
            });

            resultsDiv.innerHTML = html;
        }

        // 页面加载完成后测试
        document.addEventListener('DOMContentLoaded', function() {
            console.log('开始测试风格显示...');
            console.log('window.officialData:', window.officialData);
            if (window.officialData) {
                console.log('customGenres:', window.officialData.customGenres);
                console.log('songs count:', window.officialData.songs ? window.officialData.songs.length : 0);
            }
            testGenreDisplay();
        });
    </script>
</body>
</html>
