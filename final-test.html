<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ç»ˆé£æ ¼æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .song-item { margin: 5px 0; padding: 8px; background: #f9f9f9; }
        .genre-display { color: #007bff; font-weight: bold; }
        pre { background: #f0f0f0; padding: 10px; font-size: 12px; }
    </style>
</head>
<body>
    <h1>é£æ ¼æ˜¾ç¤ºæœ€ç»ˆæµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æ•°æ®åŠ è½½çŠ¶æ€</h2>
        <div id="dataStatus">æ­£åœ¨æ£€æŸ¥...</div>
    </div>

    <div class="test-section">
        <h2>é£æ ¼æ˜ å°„æµ‹è¯•</h2>
        <div id="genreMapping">æ­£åœ¨æµ‹è¯•...</div>
    </div>

    <div class="test-section">
        <h2>å®é™…æ­Œæ›²é£æ ¼æ˜¾ç¤º</h2>
        <div id="songGenres">æ­£åœ¨åŠ è½½...</div>
    </div>

    <script src="data.js"></script>
    <script>
        let testResults = {
            dataLoaded: false,
            genreMappingWorking: false,
            songsDisplayCorrectly: false
        };

        function checkDataStatus() {
            const statusDiv = document.getElementById('dataStatus');
            let html = '';

            if (window.officialData) {
                html += '<p class="success">âœ“ window.officialData å·²åŠ è½½</p>';
                testResults.dataLoaded = true;
                
                if (window.officialData.songs) {
                    html += `<p class="success">âœ“ æ­Œæ›²æ•°æ®å·²åŠ è½½ (${window.officialData.songs.length} é¦–)</p>`;
                } else {
                    html += '<p class="error">âœ— æ­Œæ›²æ•°æ®æœªæ‰¾åˆ°</p>';
                }

                if (window.officialData.customGenres) {
                    html += `<p class="success">âœ“ è‡ªå®šä¹‰é£æ ¼æ•°æ®å·²åŠ è½½ (${window.officialData.customGenres.length} ä¸ª)</p>`;
                    html += '<details><summary>æŸ¥çœ‹é£æ ¼æ•°æ®</summary><pre>' + 
                           JSON.stringify(window.officialData.customGenres, null, 2) + '</pre></details>';
                } else {
                    html += '<p class="error">âœ— è‡ªå®šä¹‰é£æ ¼æ•°æ®æœªæ‰¾åˆ°</p>';
                }
            } else {
                html += '<p class="error">âœ— window.officialData æœªåŠ è½½</p>';
            }

            statusDiv.innerHTML = html;
        }

        function testGenreMapping() {
            const mappingDiv = document.getElementById('genreMapping');
            let html = '';
            let successCount = 0;
            let totalCount = 0;

            if (!window.officialData || !window.officialData.customGenres) {
                html += '<p class="error">æ— æ³•æµ‹è¯•ï¼šæ•°æ®æœªåŠ è½½</p>';
                mappingDiv.innerHTML = html;
                return;
            }

            // æµ‹è¯•æ‰€æœ‰è‡ªå®šä¹‰é£æ ¼ID
            const testIds = window.officialData.customGenres.map(g => g.id);
            
            html += '<h3>é£æ ¼IDæ˜ å°„æµ‹è¯•:</h3>';
            testIds.forEach(genreId => {
                const matchedGenre = window.officialData.customGenres.find(g => g.id === genreId);
                const displayName = matchedGenre ? matchedGenre.name : genreId;
                const isCorrect = displayName !== genreId;
                
                totalCount++;
                if (isCorrect) successCount++;
                
                html += `<div class="${isCorrect ? 'success' : 'error'}">
                    ${isCorrect ? 'âœ“' : 'âœ—'} ${genreId} â†’ ${displayName}
                </div>`;
            });

            html += `<p><strong>æ˜ å°„æˆåŠŸç‡: ${successCount}/${totalCount} (${Math.round(successCount/totalCount*100)}%)</strong></p>`;
            
            testResults.genreMappingWorking = successCount === totalCount;
            mappingDiv.innerHTML = html;
        }

        function testSongGenreDisplay() {
            const songsDiv = document.getElementById('songGenres');
            let html = '';
            let correctCount = 0;
            let totalCount = 0;

            if (!window.officialData || !window.officialData.songs || !window.officialData.customGenres) {
                html += '<p class="error">æ— æ³•æµ‹è¯•ï¼šæ•°æ®æœªåŠ è½½</p>';
                songsDiv.innerHTML = html;
                return;
            }

            // æµ‹è¯•å‰20é¦–æ­Œçš„é£æ ¼æ˜¾ç¤º
            const testSongs = window.officialData.songs.slice(0, 20);
            
            html += '<h3>æ­Œæ›²é£æ ¼æ˜¾ç¤ºæµ‹è¯• (å‰20é¦–):</h3>';
            testSongs.forEach((song, index) => {
                const matchedGenre = window.officialData.customGenres.find(g => g.id === song.genre);
                const displayName = matchedGenre ? matchedGenre.name : song.genre;
                const isCorrect = displayName !== song.genre;
                
                totalCount++;
                if (isCorrect) correctCount++;
                
                html += `<div class="song-item">
                    <strong>${index + 1}. ${song.title}</strong><br>
                    é£æ ¼: <span class="genre-display ${isCorrect ? 'success' : 'error'}">${displayName}</span>
                    ${isCorrect ? ' âœ“' : ' âœ—'}
                </div>`;
            });

            html += `<p><strong>æ˜¾ç¤ºæ­£ç¡®ç‡: ${correctCount}/${totalCount} (${Math.round(correctCount/totalCount*100)}%)</strong></p>`;
            
            testResults.songsDisplayCorrectly = correctCount === totalCount;
            songsDiv.innerHTML = html;
        }

        function runAllTests() {
            console.log('å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            checkDataStatus();
            testGenreMapping();
            testSongGenreDisplay();
            
            // æ˜¾ç¤ºæ€»ä½“ç»“æœ
            setTimeout(() => {
                const allPassed = testResults.dataLoaded && testResults.genreMappingWorking && testResults.songsDisplayCorrectly;
                console.log('æµ‹è¯•ç»“æœ:', testResults);
                
                if (allPassed) {
                    console.log('ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼é£æ ¼æ˜¾ç¤ºé—®é¢˜å·²ä¿®å¤ï¼');
                } else {
                    console.log('âŒ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œéœ€è¦è¿›ä¸€æ­¥è°ƒè¯•');
                }
            }, 500);
        }

        // ç­‰å¾…æ•°æ®åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        function waitForDataAndTest() {
            if (window.officialData) {
                runAllTests();
            } else {
                console.log('ç­‰å¾…æ•°æ®åŠ è½½...');
                setTimeout(waitForDataAndTest, 100);
            }
        }

        document.addEventListener('DOMContentLoaded', waitForDataAndTest);
    </script>

    <div style="margin-top: 20px;">
        <button onclick="runAllTests()">é‡æ–°è¿è¡Œæµ‹è¯•</button>
        <button onclick="location.reload()">åˆ·æ–°é¡µé¢</button>
    </div>
</body>
</html>
